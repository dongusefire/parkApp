<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>设置</title>
    <link href="../css/mui.min.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="../css/app.css"/>
    <style>
    	.logout {
    		margin:20px 5%;
    	}
    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav header-bar">
		<a class="mui-action-back  mui-pull-left back"><span class="mui-icon mui-icon-arrowleft" style="font-size: 35px; padding-top: 3px;color:#292929;"></span></a>
	    <h1 class="mui-title">设置</h1>
	</header>
	<div class="mui-content g-content">
		<ul class="mui-table-view">
		    <li class="mui-table-view-cell" id="clear">清除storage</li>
		</ul>
		<div class="logout" style="display: none;">
			<button type="button" class="mui-btn mui-btn-danger mui-btn-block">退出登录</button>
		</div>
	</div>
    <script src="../js/mui.min.js"></script>
    <script src="../js/app.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
    	function upwo(){ //更新父页面的数据
    		//获取我的页面的窗口对象
    		var wo = plus.webview.currentWebview().opener();
			//触发我的页面（readData）,从而进行数据刷新
			mui.fire(wo,'readData');
    	};
    	var login_off = false,token = null;
    	mui.plusReady(function(){
    		token=plus.storage.setItem('token');
    		if(token){
    			mui('.logout')[0].style.display = 'block';
    		};
    	});
    	mui('.g-content').on('tap','#clear',function(){
			plus.storage.clear();
			upwo();
			mui.toast("已清除");
    	});
    	mui('.g-content').on('tap','.logout',function(){
    		var _this = this;
    		if(!login_off){
    			setTimeout(function(){
    				plus.storage.removeItem('phone_number');
    				plus.storage.removeItem('token');
    				upwo();
    				login_off = false;
    				_this.style.display = 'none';
    				mui.toast('退出成功');
    			},500);
    			mui.ajax(AJAX_PATH+'/auth/logout?token='+token,{
					dataType:'json',
					type:'get',
					success:function(res,textStatus,xhr){
//						if(res.code==200){
//							mui.toast(res.msg);
//						};
					},
					complete:function(xhr, status){
						login_off = false;
					}
				});
    		};
    	});
    </script>
</body>
</html>